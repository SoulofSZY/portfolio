## 微服务治理

### 问题
一次服务调用，服务提供者、注册中心、网络这三者都可能会有问题，此时服务消费者应该如何处理才能确保调用成功呢

### 手段

**节点管理**

1. 注册中心主动摘除机制
2. 服务消费者摘除机制

**负载均衡**

1. 随机算法
2. 轮询算法：权重
3. 最少活跃调用算法
4. 一致性Hash算法：相同参数的请求总是发到同一服务节点

**服务路由**

**服务容错**

### 服务端故障

集群故障/单IDC故障/单机故障

**集群故障**

限流/降级

**单IDC故障**

流量切换

**单机故障**

重启以期快速恢复
定位故障具体原因

### 服务调用失败

>超时、重试、双发以及熔断，实际使用时，具体选择哪种手段要根据具体业务情况来决定。

>根据我的经验，大部分的服务调用都需要设置超时时间以及重试次数，当然对于非幂等的也就是同一个服务调用重复多次返回结果不一样的来说，不可以重试，比如大部分上行请求都是非幂等的。至于双发，它是在重试基础上进行一定程度的优化，减少了超时等待的时间，对于长尾请求的场景十分有效。采用双发策略后，服务调用的P999能大幅减少，经过我的实践证明是提高服务调用成功率非常有效的手段。而熔断能很好地解决依赖服务故障引起的连锁反应，对于线上存在大规模服务调用的情况是必不可少的，尤其是对非关键路径的调用，也就是说即使调用失败也对最终结果影响不大的情况下，更加应该引入熔断。