## 单体走向服务化

1. 什么时候应该拆分单体应用
2. 拆分单体应用有哪些标准可依


**拆分单体应用的时机**

*项目第一阶段的主要目标是快速开发和验证想法，证明产品思路是否可行。这个阶段功能设计一般不会太复杂，开发采取快速迭代的方式，架构也不适合过度设计。所以将所有功能打包部署在一起，集中地进行开发、测试和运维，对于项目起步阶段，是最高效也是最节省成本的方式

*当可行性验证通过，功能进一步迭代，就可以加入越来越多的新特性。这个时候就需要大规模地扩张开发人员，以支撑多个功能的开发。如果这个时候继续采用单体应用架构，多个功能模块混杂在一起开发、测试和部署的话，就会导致不同功能之间相互影响，一次打包部署需要所有的功能都测试OK才能上线。

*一旦单体应用同时进行开发的人员超过10人，就会遇到上面的问题，这个时候就该考虑进行服务化拆分了

+实际，项目可行性验证通过，就应该开始考虑服务化拆分，早期开发应该以拆分微服务的标准来开发和业务分界，对于时下的互联网项目，都不会太小。

**服务化拆分的两种姿势**
>服务化拆分实施方式，一个最有效的手段就是将不同的功能模块服务化，独立部署和运维

>纵向拆分：即从业务维度进行拆分，标准是按照业务的关联程度来决定，关联比较密切的业务适合拆分为一个微服务，而功能相对比较独立的业务适合单独拆分成一个微服务
>横向拆分：即从公共且独立功能维度拆分，标准是按照是否有公共的被多个其他服务调用，且依赖的资源独立不与其他业务耦合

+ 业务边界是服务化拆分的一个重要依据

**服务化拆分的前置条件**

问题

> 1. 业务系统引入新技术必然会带来架构的复杂度提升
> 2. 新架构会带来哪些新的问题，这些问题是否有解决方案
> 3. 对于一些新问题，是团队自行建设，还是采用业界开源方案

1. 服务如何定义，服务如何向外界传达自己的信息？
	接口，通讯方式 HTTP/RPC,服务之间的调用都通过接口描叙来约定，约定内容包括接口名，接口参数以及接口返回值
2. 服务如何发布和订阅，服务提供者如何暴露自己的地址，服务调用者如       	何查询所需要调用的服务地址？
 	  注册中心
3. 服务如何监控？
	QPS/AvgTime/P999等指标，需要一种通用的监控方案，能够覆盖业务埋点，数据处理，数据展示的全链路功能
4. 服务如何治理？
	熔断机制
5. 故障如何定位？
	 需要有一种解决方案能够将一次用户请求进行标记，并在多个依赖的服务系统中继续传递，以便串联所有路径，从而进行故障定位。

以上问题服务化拆分的前提，都应该对应有解决方案

并不是说功能拆分的越细越好，过度的拆分反而会让服务数量膨胀变得难以管理，因此找到符合自己业务现状和团队人员技术水平的拆分粒度才是可取的。建议的标准是按照每个开发人员负责不超过3个大的服务为标准，毕竟每个人的精力是有限的，所以在拆分微服务时，可以按照开发人员的总人数来决定。


**经验**

1. 
一是业务维度聚类，业务和数据关系密切的应该放在一起。
二是功能维度聚类，公共功能聚合为一个服务。
三是人员聚类，这是个实际中的考量，如果某几个业务就是这几个人比较熟，那么最好放在一起，未来开发部署都好办。
四是性能聚类，性能要求高的并发大的和性能要求低的并发小的，要分开为不同的服务，这样部署和运行都独立，好维护。

2. 实际业务中这两种拆分方式一般是相互结合使用的，如果业务比较多分散，适合做纵向拆分。如果多个业务之间有公共模块耦合，适合把公共模块拆分出来，适合做横向拆分。
3. 一、业务复杂度问题单体应用没能梳理清楚，微服务也搞不懂定。
二、人手太少，微服务只会增加系统复杂度，运维成本，大家不要看到把原先的函数调用改成接口调用，没真正了解服务拆分后带来的系统复杂度。
三、系统设计问题，代码写的乱，开发流程问题，不是微服务能解决的。 
4. 微服务只能解决单体膨胀后的痛，但也会带来架构复杂性，要权衡利弊

5. 是否需要拆分要看目前公司项目的具体的情况，如果现有架构无法满足当前业务发展速度，比如构建一次要半天，上一次线经常搞通宵，牵一发而动全身，那么这个时候可以考虑一下微服务，拆微服务势必会提高运维、问题追踪、分布式事务等复杂度，所以微服务整个技术栈都要考虑进去，搞不定微服务的技术栈就不要往这个坑里跳

