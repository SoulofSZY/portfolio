## 程序中错误处理

**错误分类**

1. 资源错误：代码请求一些资源导致的错误，比如：文件操作，网络等等。
2. 程序错误：程序的错误，需要记录下来，写入日志，触发监控系统报警
3. 用户错误：由于用户不合法输入带来的错误，对这类错误可以进行统计，进行错误率分析，有利于改善软件以及侦测是否有恶意的用户请求

异常捕捉是用来处理不期望发生的事，错误码用来处理可能发生的事

**错误处理的实践**

1. 统一分类的错误字典
2. 同类错误的定义最好是可以扩展的
3. 定义错误的严重程度。Fatal:重大错误，Error:资源或者需求不满足，Warning:不一定是一个错误但需要注意，Info:不是错误只是一条信息，Debug:开发人员用于调试
4. 错误日志的输出最好使用错误码，而不是错误信息：有利于日志分析软件进行自动化监控，而不是从错误信息中做语义分析
5. 忽略的错误最好有日志。
6. 对于同一个地方不停的报错，最好不要都打到日志里。导致其他日志被淹没，也会导致日志文件过大，实践：打出一个错误+出现次数
7. 不要用错误处理逻辑来处理业务逻辑
8. 对于同类错误处理，用一样的模式
9. 尽可能在错误发生的地方处理错误
10. 向上尽可能返回原始错误
11. 处理错误时，总是要处理已经分配的资源
12. 不推荐在循环体里处理错误
13. 不要把大量代码都放在一个try语句块内
14. 对错误定义提供清楚的文档以及每种错误的代码示例
15. 对于异步的方式，推荐使用Promise模式处理错误
16. 对于分布式系统，推荐使用APM相关的软件